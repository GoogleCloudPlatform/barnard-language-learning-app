#!/usr/bin/env bash
set -euo pipefail

CURRENT_PATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
SRC_MAIN_TERRAFORM="${CURRENT_PATH}/../terraform"
ARGS_TERRAFORM="${@}"

echo "${CURRENT_PATH}"
source "${CURRENT_PATH}/../config/values.sh"

echo "${CURRENT_PATH}/../config/values.sh"

cd "${SRC_MAIN_TERRAFORM}"

echo "${GCP_BILLING_ACCOUNT_ID}"

terraform init
terraform fmt
terraform "${ARGS_TERRAFORM}" \
  -var "project_name=${GCP_PROJECT_NAME}" \
  -var "billing_account=${GCP_BILLING_ACCOUNT_ID}" \
  -var "org_id=${GCP_ORG_ID}" \
  -var "region=${GCP_REGION}" \
  -var "folder_id=${GCP_FOLDER_ID}" \
  "."
